+++
title = "拯救synology nas上raid1內接硬碟資料"
date = "2016-05-13"
tags = [ "nas"]
categories = [ "tips" ]
meta_description = "copy nas raid1 data"
meta_keywords = "nas raid1 data,nas raid 外接讀檔,讀取nas raid 資料"
+++

有用nas的，早晚會碰到nas壞了或是啥不可預測的神之力  
總之nas裡的硬碟多多少少會有機會碰到要外接讀取資料的機會  

安迪兒也不例外  
某天安迪兒nas容量不夠，要買新的硬碟  
因為安迪兒nas(ds213j)很慢  
只有usb2傳輸，1g的網路，傳輸上限也只能到每秒30多MB    
總之…備資料要超久的  

於是安迪兒把裡面的raid1拆一顆硬碟下來  
拿到公司，想說外接公司nas把資料快速的備份出來  
但…安迪兒天真的以為，raid1不就是2顆硬碟一模模一樣樣  
隨便拿一顆接上硬碟外接盒，把裡面的檔案讀出來就好了。

果然是事情沒想的那麼容易  
硬碟外接後，不管接到電腦或nas都讀不到東西  
最多只讀到加密的raid磁區  

安迪兒整個傻眼，深吸了一口氣  
想著，那天…安迪兒的機器壞了，找不到同型號的
…就gg了嗎!!!  
(這太蝦了吧!!)  

於是安迪兒在茫茫google海裡，研究了一下  
找到了可能的方案，利用linux software raid的方式  
弄個raid來試試讀資料    
參考資料如下:  
http://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-ig-s390-multi-zh_tw-4/s1-s390info-raid.html  
https://en.wikipedia.org/wiki/Mdadm  
http://linux.die.net/man/8/mdadm  

以下就是安迪兒整個修復的過程   

用usb外接盒裝上硬碟，接上公司的nas  
<img src="https://goo.gl/KRwMJv" width="100%">  

執行以下步驟    

1.修復原raid1 HDD  
mdadm -A -R /dev/xxx /dev/xxx  

2.fdisk -l xx 找一下相關磁碟資訊  
可以看一下Blocks的大小，猜一下大的是存資的磁區  
<img src="https://goo.gl/HgYp7X" width="100%">  
<img src="https://goo.gl/x5HRGm " width="100%">  


3.建新目錄  
mkdir /mnt/old_hdd  
<img src="https://goo.gl/9b3IwR" width="100%">  

4.把找到的md2掛到剛建的目錄裡  
mount -t ext4 /dev/md2 /mnt/old_hdd/  
<img src="https://goo.gl/9b3IwR" width="100%">  
<img src="https://goo.gl/AnRUcF" width="100%">  


5.開始copy資料吧，此時nas裡面應該讀的到資料了  
<img src="https://goo.gl/YzvS4H" width="100%">  
<img src="https://goo.gl/s9wRxr" width="100%">   

6.完成後  
unmount資料匣    
removed md virtual device  

全部用到的指令如下:  

    fdisk -l
    mdadm -A -R /dev/md2 /dev/sde3
    mkdir /mnt/old_hdd
    mount -t ext4 /dev/md2 /mnt/old_hdd/
    mount | grep ^/dev/md2
    umount /mnt/old_hdd
    mdadm -S /dev/md2


到這邊…有沒發現一件事    
其實所謂的raid，就是用software raid的方式弄的  
如果是硬體晶片的話可能就解不出來了  
有好有壞啦~XD

另外，新的nas超快，用usb3，或是直接網路傳檔  
每秒都有100mb以上的速度，真是差太多了。

以上~~收工嘍!
