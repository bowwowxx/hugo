+++
title = "修改Ubuntu ulimit限制"
date = "2016-06-04"
tags = [ "ubuntu","gce"]
categories = [ "tips" ]
meta_description = "Ubuntu ulimit限制 Ubuntu ulimit,Too many open files in system"
meta_keywords = "Ubuntu ulimit,Too many open files in system"
+++

安迪兒最近在壓測時碰上了    
Too many open files in system

看了一下gce上機器的資源其實還好  
應該可以再榨一點效能出來  
想說檔案數再開大一點試試  

記錄一下調整的方式  
先登入看一下系統預設數量是多少  
```
ulimit -n
```  
嗯~1024，應該可以再開多一些  
<img src="https://goo.gl/yEVVY6" width="70%">  

改一下數字  
```
sudo ulimit -n 65535  
```  
#### 呃~command not found  
<img src="https://goo.gl/6yAXrv" width="70%">  

sudo無法執行ulimit  
原因是ulimit是bash内置命令   
改一下用su -，再輸入ulimit  
```
su -  
ulimit -n 65536  
```   

查一下改完後的數量，應該ok了
```
ulimit -n
```
<img src="https://goo.gl/CPrByn" width="70%">  

以上手動設定，**重開機後會消失~XD**      

#### 安迪兒查了一些開機自動設定的方式    
記錄一下最後試的設定  

#### 1. 修改/etc/security/limits.conf   
 <img src="https://goo.gl/Tg5nxZ" width="70%">  

```  
* soft nofile 65535   
* hard nofile 65535
```  
#### 2.修改 /etc/pam.d/common-session  
加上這行
```
session required pam_limits.so  
```  
<img src="https://goo.gl/muLvxD" width="70%">  

#### 3.編輯/etc/profile  
加上ulimit -SHn 65535

#### 4.收工了，重啟一下  
```
sudo reboot  
```  

#### 5.看看有沒效  
查一下ulimit      

```
ulimit -a  
```  
<img src="https://goo.gl/jNIRG5" width="70%">

看來這樣就ok了    
以上!收工嘍~
